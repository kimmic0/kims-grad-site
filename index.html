<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>Kim‚Äôs Graduation üéì</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Asap+Condensed&family=Monsieur+La+Doulaise&family=Alumni+Sans&family=Silkscreen&family=Libre+Bodoni:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
/* ------------------- Root + Base ------------------- */
:root {
  --bw-1:#000;
  --bw-2:#111;
  --bw-3:#333;
  --bw-4:#fff;
  --accent:#dedede;
}

html, body {
  margin:0;
  padding:0;
  width:100%;
  max-width:100%;
  overflow-x:hidden;
  font-family:'Alumni Sans', sans-serif;
  background:var(--bw-4);
  color:var(--bw-1);
  text-align:center;
}

/* ------------------- Launch Screen ------------------- */
#launch-screen {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle, #000 60%, #111);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  z-index: 999999;
  cursor: pointer;
  animation: fadeIn 1s ease forwards;
}
.invite-box { text-align: center; animation: float 2s ease-in-out infinite alternate; }
#launch-screen h1 {
  font-family: 'Monsieur La Doulaise', cursive;
  margin: 0 auto 20px;
  text-shadow: 0 0 10px white;
}
#launch-screen p { font-size: 1.5rem; letter-spacing: 1px; color: #ddd; }
.envelope { font-size: 5rem; margin-top: 20px; animation: pulse 1.5s infinite; }

@keyframes float { from { transform: translateY(-10px); } to { transform: translateY(10px); } }
@keyframes pulse { 0%,100% { transform: scale(1); opacity:1 } 50% { transform: scale(1.2); opacity:.7 } }
@keyframes fadeOut { to { opacity:0; visibility:hidden } }
@keyframes fadeIn { from{opacity:0} to{opacity:1} }

/* ------------------- Header ------------------- */
header {
  padding: 40px 20px 0;
  margin: 0;
  border-bottom: 2px solid var(--bw-1);
  background-color: var(--bw-4);
}
header h1 {
  margin: 0;
  padding: 0;
  font-family:'Monsieur La Doulaise', cursive;
  font-size: 42px;
  letter-spacing: 1px;
  line-height: 1.2;
}
header h1 img { display:block; margin:10px auto 0; width:60px; height:auto; }
header p { margin: 0; padding: 0; font-size: 30px; font-weight: bold; color: #333; line-height: 1.1; }

/* Section titles + text */
h2 { font-size: 48px; font-weight: 700; font-family: 'Alumni Sans', sans-serif; }
p  { font-size: 26px; line-height: 1.4; }

/* ------------------- Tabs ------------------- */
.tabs {
  font-family: 'Asap Condensed';
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  background-color:var(--bw-1);
  padding:10px 0;
  margin:0;
  border-top: 2px solid var(--bw-1);
  border-bottom: 2px solid var(--bw-1);
}
.tab {
  font-family: 'Asap Condensed';
  background:linear-gradient(120deg,var(--bw-4) 0%, #ccc 30%, var(--bw-4) 50%);
  background-size:200% auto;
  color:var(--bw-1);
  padding:10px 25px;
  border:2px solid var(--bw-1);
  margin:5px;
  border-radius:30px;
  font-size:24px;
  cursor:pointer;
  transition:.3s ease;
}
.tab:hover { animation:shine 1.2s linear infinite; transform:scale(1.05); }
@keyframes shine { 0%{background-position:-200% center;} 100%{background-position:200% center;} }

.tab-content {
  width: 100%;
  max-width: 900px;
  margin: 0 auto;
  display:none;
  padding:20px 10px;
  animation:fadeIn .4s ease;
}
.tab-content p {
  max-width: 90%;
  margin: 0 auto 20px;
  text-align: center;
  line-height: 1.4;
  word-wrap: break-word;
  overflow-wrap: break-word;
}
.active { display:block; }

/* ------------------- Main & Journey BG ------------------- */
#main-content { position:relative; z-index:1; min-height:400px; transition:background .5s ease; }
.journey-active { background-color:var(--bw-1); color:var(--bw-4); }
.journey-bg {
  position:absolute; inset:0;
  pointer-events:none; opacity:0; transition:.4s ease;
}
.journey-active .journey-bg { opacity:1; }

/* ------------------- Timeline ------------------- */
.timeline-container { width:100vw; padding:60px 0; overflow-x:auto; }
.timeline { display:flex; flex-wrap:wrap; gap:40px; justify-content:center; }
.point {
  width:20px; height:20px; background:white; border:2px solid silver; border-radius:50%;
  cursor:pointer; position:relative; transition:.3s ease; z-index:2;
}
.point:hover { transform:scale(1.2); box-shadow:0 0 12px rgba(200,200,200,0.8); }

.timeline-led {
  position:absolute; top:50%; left:50%; width:16px; height:16px; background:white; border-radius:50%;
  transform:translate(-50%,-50%); pointer-events:none; opacity:.4; z-index:1;
}

/* Journey display */
#journey-display img {
  max-width:80%; border-radius:12px; border:2px solid #fff; display:none; margin-top:20px;
}
#journey-display p { color:white; font-size:1.1em; margin-top:10px; }

/* ------------------- Footer ------------------- */
footer {
  background:var(--bw-1); padding:20px; color:var(--bw-4);
  position:relative; overflow:hidden;
}
footer::before {
  content:""; position:absolute; inset:0; left:50%;
  width:100vw; height:100%; background:var(--bw-1); transform:translateX(-50%); z-index:-1;
}
footer p { animation:neonPulse 1.8s ease-in-out infinite alternate; margin:5px 0; }
@keyframes neonPulse {
  0%,100%{ text-shadow:0 0 5px #fff,0 0 10px #fff,0 0 20px #fff; }
  50%   { text-shadow:0 0 10px #fff,0 0 20px #fff,0 0 40px #fff; }
}

/* ------------------- Lightbox ------------------- */
#lightbox {
  display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85);
  justify-content:center; align-items:center; z-index:10000;
}
#lightbox img { max-width:90%; max-height:90%; border-radius:15px; border:2px solid #fff; }

/* ------------------- Achievement Sidebar (pixel) ------------------- */
#achievement-sidebar {
  position: fixed; top: 220px; right: 0;
  width: 40px; /* collapsed */
  background: linear-gradient(#111, #000);
  border-left: 3px solid #666;
  padding: 8px 0;
  border-radius: 8px 0 0 8px;
  font-family: "Press Start 2P", monospace;
  color: white;
  z-index: 9999;
  transition: width .25s ease, padding .25s ease, transform .25s ease;
  box-shadow: -6px 6px 0 #000 inset;
}

/* Desktop: expand on hover */
@media (hover: hover) {
  #achievement-sidebar:hover { width: 320px; padding: 8px; }
}

/* Mobile default: smaller collapsed */
@media (max-width: 600px) {
  #achievement-sidebar { width: 26px; padding: 4px 0; }
}

/* Mobile: expanded when tapped (class added via JS) */
#achievement-sidebar.mobile-open {
  width: 80vw; max-width: 360px; padding: 8px;
}

/* A visible little grabber/handle always tappable */
#sidebar-toggle {
  position: absolute; left: -16px; top: 12px;
  width: 16px; height: 40px; border-radius: 8px 0 0 8px;
  background: #000; border:2px solid #666; border-right:none;
  box-shadow: -2px 0 0 #000 inset;
  cursor: pointer;
  display: flex; align-items:center; justify-content:center;
}
#sidebar-toggle:after { content: "‚â°"; color:#fff; font-size: 12px; }

/* Inside list */
#achievements-list { display:flex; flex-direction:column; gap:6px; padding: 8px; }
.achievement {
  background: linear-gradient(#222,#111);
  padding:6px; width: 100%;
  border:3px solid #000; border-left-width:6px; border-top-width:6px;
  display:flex; gap:8px; align-items:center; color:white; box-shadow: 3px 3px 0 #000; image-rendering: pixelated;
}
.achievement .icon {
  width:34px; height:34px; background:#fff; border:2px solid #000;
  display:flex; align-items:center; justify-content:center; font-weight:900; color:#111; image-rendering: pixelated;
}
#achievements-unlocked h3 {
  margin: 0 0 6px; text-align: center; font-size: 14px; text-decoration: underline; color: var(--bw-4); letter-spacing: 1px;
}

/* ------------------- Achievement Toast (Minecraft-like) ------------------- */
#achievement-toast {
  position: fixed;
  left: 50%;
  top: 72px;
  transform: translateX(-50%);
  background: linear-gradient(to bottom, #222, #000);
  border: 3px solid #888;
  border-radius: 6px;
  padding: 10px 18px;
  display: flex;
  align-items: center;
  gap: 10px;
  opacity: 0;
  z-index: 100000;
  transition: opacity .25s ease, top .25s ease;
  font-family: "Press Start 2P", monospace;
  color: white;
  box-shadow: 0 0 8px #777;
  image-rendering: pixelated;
}
#achievement-toast.show {
  opacity: 1;
  top: 92px;
  animation: slideIn 0.4s ease-out;
}

#achievement-toast .text .title {
  font-size: 10px;
  color: #bbb;
  letter-spacing: 1px;
  margin: 0;
}

#achievement-toast .text .name {
  font-size: 12px;
  font-weight: bold;
  color: white;
  margin: 0;
  text-shadow: 0 0 4px #aaa;
}

/* ------------------- Popup (Old style restored) ------------------- */
#achievement-popup {
  position: fixed; bottom: 40px; left: 40px;
  display: none; z-index: 10000; animation: slideIn 0.4s ease-out;
}
#achievement-popup-inner {
  background: linear-gradient(to bottom, #222, #000);
  color: white; padding: 10px 20px; border: 2px solid #888; border-radius: 6px;
  font-family: "Press Start 2P", monospace; box-shadow: 0 0 8px #777;
}
#achievement-popup-title {
  color: #bbb; font-size: 10px; display: block; margin-bottom: 6px; letter-spacing: 1px;
}
#achievement-popup-text { font-size: 12px; color: #fff; text-shadow: 0 0 4px #aaa; }
@keyframes slideIn { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

/* ------------------- Confetti & Sparkles ------------------- */
.confetti { position:fixed; width:8px; height:8px; background:#9e9e9e; opacity:0.95; z-index:100001; border-radius:2px; }
.sparkle  { position:fixed; width:6px; height:6px; border-radius:50%; box-shadow:0 0 8px #fff; opacity:.9; z-index:100002; }

/* ------------------- Responsive ------------------- */
@media (max-width: 500px){
  header h1 { font-size: 34px; }
  .tab { padding: 8px 14px; font-size: 18px; margin: 4px; }
  .tabs { padding: 6px 0; gap: 4px; }
}
  /* ‚úÖ Make uploaded photos scale correctly on mobile */
#gallery img {
  max-width: 90%;
  width: auto;
  height: auto;
  border-radius: 15px;
  border: 2px solid var(--bw-1);
  margin: 10px auto;
  display: block;
}

</style>
</head>

<body>
<!-- Invitation Screen -->
<div id="launch-screen">
  <div class="invite-box">
    <h1>You‚Äôve Been Invited üéì</h1>
    <p>Tap to open Kim‚Äôs Graduation Website</p>
    <div class="envelope">‚úâÔ∏è</div>
  </div>
</div>

<header>
  <h1>Kim‚Äôs Graduation Website
    <img src="https://media.tenor.com/eGCjV7lEokoAAAAj/black-bow.gif" alt="black-bow">
  </h1>
  <p>Bachelor of Science in Computer Engineering</p>
  <p>Elegant. Intelligent. Empowered by Jehovah</p>
</header>

<!-- Tabs -->
<div class="tabs">
  <button class="tab" onclick="openTab('home')">Home</button>
  <button class="tab" onclick="openTab('dresscode')">Dress Code</button>
  <button class="tab" onclick="openTab('guestbook')">Guestbook</button>
  <button class="tab" onclick="openTab('photos')">Photos</button>
  <button class="tab" onclick="openTab('wishlist')">Gift Ideas</button>
  <button class="tab" onclick="openTab('journey')">My Journey</button>
</div>

<div id="main-content">
  <canvas class="journey-bg" id="journey-bg"></canvas>

  <!-- HOME -->
  <div id="home" class="tab-content active">
    <h2>Welcome!</h2>
    <p>Thank you for celebrating this milestone with me! So happy to be able to say that all the obstacles I've overcome were well worth it in the end.</p>
    <p>I'm incredibly grateful to God and to my family for their continuous love and support.</p>

    <div id="invitation" style="margin-top:30px; text-align:center;">
      <p style="font-style:italic;font-family:'Alumni Sans';">
        <strong>Love,<br>Kim</strong>
      </p>
      <hr style="width:50px;border:1px solid #ccc;margin:10px auto 20px;">
      <p style="font-size:2rem;color:#222;">
        You are cordially invited to celebrate my graduation!<br>
        <strong>Location will be shared privately upon RSVP.</strong><br>
        <strong>Date:</strong> Saturday, December 20, 2025<br>
        <strong>Time:</strong> 4:30 PM<br>
        <strong>üìß Email:</strong> kimannrojas04@gmail.com
      </p>
    </div>
  </div>

  <!-- DRESS CODE -->
  <div id="dresscode" class="tab-content">
    <h2>Dress Code</h2>
    <p>
      To honor the elegance of this special occasion, guests are kindly requested to observe a formal dress code.
      Attire should reflect sophistication and grace, with a refined color palette of black and white.
      Gentlemen are encouraged to wear dress shirts, tailored slacks, or a classic suit, while ladies are invited
      to wear dresses or other formal ensembles. Thank you for celebrating this milestone with style.
    </p>
    <img src="dresscode.jpg" alt="Dress Code" style="max-width:80%;border-radius:12px;margin-top:20px;border:2px solid #000;">
  </div>

  <!-- GUESTBOOK -->
  <div id="guestbook" class="tab-content">
    <h2>üí¨ Guestbook</h2>
    <input id="nameInput" type="text" placeholder="Your name..."><br>
    <textarea id="messageInput" placeholder="Leave a sweet message for Kim..."></textarea><br>
    <button onclick="postMessage()">Post</button>
    <div id="messages"></div>
  </div>

  <!-- PHOTOS -->
  <div id="photos" class="tab-content">
    <h2>Share a Photo</h2>
    <input type="file" id="photoInput" accept="image/*"><br>
    <button id="uploadBtn" onclick="uploadPhoto()">Upload Photo üì∏</button>
    <div id="gallery"></div>
  </div>

  <!-- WISHLIST -->
  <div id="wishlist" class="tab-content">
    <h2>Gift Registry</h2>
    <p>Thank you so much for your thoughtfulness!</p>
    <p>
      I have lovingly curated an 
      <a href="https://www.amazon.com/hz/wishlist/ls/FB17XEUSTE2K?ref_=wl_share" target="_blank">Amazon Wishlist</a>.
    </p>
    <p>Monetary gifts are also graciously welcomed and deeply appreciated.</p>
  </div>

  <!-- JOURNEY -->
  <div id="journey" class="tab-content">
    <h2 style="color:white;">üõ†Ô∏è My Journey</h2>

    <div class="timeline-container">
      <div class="timeline">
        <div class="point" data-img="journey2.jpg" data-desc="2020 ‚Äì Engineering Fundamentals"></div>
        <div class="point" data-img="journey3.jpg" data-desc="2021 ‚Äì Coding Foundations üíª"></div>
        <div class="point" data-img="journey4.jpg" data-desc="2022 ‚Äì Digital Logic Design & Data Structures"></div>
        <div class="point" data-img="journey5.jpg" data-desc="2023 ‚Äì Circuits & Operating Systems"></div>
        <div class="point" data-img="journey6.jpg" data-desc="2024 ‚Äì Electronics & Microcontrollers"></div>
        <div class="point" data-img="journey7.jpg" data-desc="2025 ‚Äì Graduation! üéì"></div>
      </div>
    </div>

    <div id="journey-display">
      <img id="journey-img" src="" alt="">
      <p id="journey-desc"></p>
    </div>
  </div>
</div>

<!-- Lightbox -->
<div id="lightbox"><img id="lightbox-img" alt=""></div>

<footer>
  <p>"Elegance is intelligence made visible."</p>
  <p>‚Äî Celebrating Grace & Code üéì</p>
</footer>

<!-- Achievement Toast -->
<div id="achievement-toast" aria-live="polite">
 <img src="white_trophy.gif" alt="achievement icon" style="width:32px;height:32px;image-rendering:pixelated;">
  <div class="text">
    <p class="title">Achievement Unlocked!</p>
    <p class="name" id="toast-name">Name</p>
  </div>
</div>


<!-- Achievement Sound -->
<audio id="achievement-sound" src="levelup.mp3" preload="auto"></audio>

<!-- ======================= SCRIPTS ======================= -->
<script type="module">
/* -------------------- Firebase -------------------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyBXrTc31-4bNMkdh4DTvLu29vBHOS66gEA",
  authDomain:"kim-s-grad-website.firebaseapp.com",
  projectId:"kim-s-grad-website"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* -------------------- Achievements -------------------- */
const achievements = {
  "Hello, World!": false,
  "Data Collector": false,
  "Logger": false,
  "System Scanner": false,
  "Process Tracker": false,
  "Interface Designer": false,
  "Computer Engineer": false
};
const achievementsList = document.getElementById("achievements-list");
const achievementSound = document.getElementById("achievement-sound");

function makeIconLetter(letter){
  const el = document.createElement("div");
  el.className="icon";
  el.textContent = letter || "‚úì";
  return el;
}

function playAchievementSound(){
  if(!achievementSound) return;
  // Try to play; if blocked, create a quick oscillator fallback
  achievementSound.currentTime = 0;
  achievementSound.play().catch(() => {
    try {
      const Ctx = window.AudioContext || window.webkitAudioContext;
      const ctx = new Ctx();
      const o = ctx.createOscillator(); const g = ctx.createGain();
      o.type = 'square'; o.frequency.value = 660; g.gain.value = 0.08;
      o.connect(g); g.connect(ctx.destination); o.start(); o.stop(ctx.currentTime + 0.2);
    } catch(e){}
  });
}

function showToast(name){
  const toast = document.getElementById("achievement-toast");
  document.getElementById("toast-name").textContent = name;
  toast.classList.add("show");
  setTimeout(()=> toast.classList.remove("show"), 3800);
}

function popupMessage(text){
  const pop = document.getElementById("achievement-popup");
  const label = document.getElementById("achievement-popup-text");
  if(!pop || !label) return;
  label.textContent = text;
  pop.style.display = "block";
  clearTimeout(popupMessage._t);
  popupMessage._t = setTimeout(()=> pop.style.display = "none", 2600);
}

function spawnConfettiAndSparkles(){
  for(let i=0;i<22;i++){
    const c=document.createElement("div");
    c.className="confetti";
    c.style.left = (window.innerWidth-200 + Math.random()*180) + "px";
    c.style.top = (80 + Math.random()*120) + "px";
    document.body.appendChild(c);
    const fall = [
      { transform: `translateY(0) rotate(0deg)`, opacity:1 },
      { transform: `translateY(${80 + Math.random()*120}px) rotate(${Math.random()*360}deg)`, opacity:0 }
    ];
    const dur = 900 + Math.random()*900;
    c.animate(fall, { duration: dur, easing: 'cubic-bezier(.2,.6,.2,1)' });
    setTimeout(()=>c.remove(), dur+50);

    if(Math.random()<0.6){
      const s=document.createElement("div");
      s.className="sparkle";
      s.style.left = (window.innerWidth-200 + Math.random()*180) + "px";
      s.style.top  = (80 + Math.random()*120) + "px";
      document.body.appendChild(s);
      const sparkleAnim = [
        { transform: 'scale(0.6)', opacity: 1 },
        { transform: 'scale(1.6)', opacity: 0 }
      ];
      const sDur = 600 + Math.random()*600;
      s.animate(sparkleAnim,{ duration: sDur, easing: 'ease-out' });
      setTimeout(()=>s.remove(), sDur + 200);
    }
  }
}

function unlockAchievement(name){
  if(achievements[name]) return;
  achievements[name] = true;

  const tile = document.createElement("div");
  tile.className = "achievement";
  const icon = makeIconLetter(name[0]);
  const label = document.createElement("div");
  label.className = "label";
  label.textContent = name;
  tile.appendChild(icon);
  tile.appendChild(label);
  achievementsList.appendChild(tile);

  playAchievementSound();   // ‚úÖ restored sound
  showToast(name);          // ‚úÖ toast
  spawnConfettiAndSparkles();

  // Hidden achievement check
  if(
    achievements["Hello, World!"] &&
    achievements["Data Collector"] &&
    achievements["Logger"] &&
    achievements["Interface Designer"] &&
    achievements["Process Tracker"] &&
    achievements["System Scanner"] &&
    !achievements["Computer Engineer"]
  ){
    setTimeout(()=> unlockAchievement("Computer Engineer"), 1500);
  }
}

/* -------------------- Tabs -------------------- */
window.openTab = function(id){
  document.querySelectorAll(".tab-content").forEach(t=> t.classList.remove("active"));
  const target = document.getElementById(id);
  if(target){ target.classList.add("active"); }

  const main = document.getElementById("main-content");
  if(id==="journey") main.classList.add("journey-active");
  else main.classList.remove("journey-active");

  if(id==="dresscode") unlockAchievement("Interface Designer");
  if(id==="wishlist")  unlockAchievement("System Scanner");
};

/* -------------------- Guestbook -------------------- */
window.postMessage = async function(){
  const name = (document.getElementById("nameInput").value || "Anonymous").trim();
  const message = (document.getElementById("messageInput").value || "").trim();
  if(!message) return;

  await addDoc(collection(db,"guestbook"),{ name, text: message, date: new Date().toISOString() });

  document.getElementById("nameInput").value = "";
  document.getElementById("messageInput").value = "";

  await renderMessages();
  unlockAchievement("Logger");
};

async function renderMessages(){
  const container = document.getElementById("messages");
  container.innerHTML="";
  const qy = query(collection(db,"guestbook"), orderBy("date","desc"));
  const snap = await getDocs(qy);
  snap.forEach(doc=>{
    const d=doc.data();
    const div=document.createElement("div");
    div.innerHTML = `
      <strong>${d.name}</strong>
      <span style='color:#555;font-size:0.8em'> ‚Ä¢ ${new Date(d.date).toLocaleString()}</span>
      <p>${d.text}</p>
    `;
    container.appendChild(div);
  });
}

/* -------------------- Photos (Cloudinary) -------------------- */
window.uploadPhoto = async function(){
  const file = document.getElementById("photoInput").files[0];
  if(!file) return alert("Please select a photo!");

  const cloudName = "dhnsjcgko";
  const preset = "Grad_2025_Gallery";
  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", preset);

  const uploadBtn = document.getElementById("uploadBtn");
  uploadBtn.disabled = true; uploadBtn.textContent = "Uploading...";

  try{
    const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, { method:"POST", body: formData });
    const data = await res.json();
    if(!res.ok || !data.secure_url) throw new Error(data.error?.message || "Upload failed");

    const img = document.createElement("img");
    img.src = data.secure_url;
    document.getElementById("gallery").prepend(img);

    await addDoc(collection(db,"photos"),{ url:data.secure_url, date:new Date().toISOString() });

    uploadBtn.textContent="Upload Photo üì∏";
    uploadBtn.disabled=false;

    unlockAchievement("Data Collector");
    setupLightbox();
  } catch(err){
    alert("Upload failed!");
    uploadBtn.textContent="Upload Photo üì∏";
    uploadBtn.disabled=false;
  }
};

async function renderGallery(){
  const gallery = document.getElementById("gallery");
  gallery.innerHTML = "";
  const qy = query(collection(db,"photos"), orderBy("date","desc"));
  const snap = await getDocs(qy);
  snap.forEach(doc=>{
    const img = document.createElement("img");
    img.src = doc.data().url;
    gallery.appendChild(img);
  });
  setupLightbox();
}

function setupLightbox(){
  const lb = document.getElementById("lightbox");
  const lbImg = document.getElementById("lightbox-img");
  document.querySelectorAll("#gallery img").forEach(img=>{
    img.onclick = ()=>{ lb.style.display="flex"; lbImg.src=img.src; };
  });
  lb.onclick = (e)=>{ if(e.target!==lbImg) lb.style.display="none"; };
}

/* -------------------- Timeline Hover -------------------- */
document.querySelectorAll(".point").forEach(point=>{
  point.addEventListener("mouseenter",()=>{
    const img = document.getElementById("journey-img");
    const desc = document.getElementById("journey-desc");
    img.src = point.dataset.img;
    desc.textContent = point.dataset.desc;
    img.style.display="block";
    unlockAchievement("Process Tracker");
  });
  point.addEventListener("mouseleave",()=>{
    document.getElementById("journey-img").style.display="none";
    document.getElementById("journey-desc").textContent="";
  });
});

/* -------------------- Cursor trail (bow) -------------------- */
const blackBow='https://media.tenor.com/eGCjV7lEokoAAAAj/black-bow.gif';
const whiteBow='invertedwhitebow.gif'; // ensure this file exists in your repo

function getBgColor(elem){
  while(elem){
    const color = window.getComputedStyle(elem).backgroundColor;
    if(color && color !== 'rgba(0, 0, 0, 0)' && color !== 'transparent') return color;
    elem = elem.parentElement;
  }
  return 'rgb(255,255,255)';
}
function getLuminance(rgb){
  const m = rgb?.match?.(/(\d+),\s*(\d+),\s*(\d+)/);
  if(!m) return 255;
  const r = +m[1], g = +m[2], b = +m[3];
  return 0.299*r + 0.587*g + 0.114*b;
}
function dropBow(x, y){
  const img = document.createElement('img');
  const under = document.elementFromPoint(x, y);
  const src = (getLuminance(getBgColor(under)) < 128) ? whiteBow : blackBow;
  img.src = src;
  img.alt = "";
  img.style.position = 'absolute';
  img.style.left = (window.scrollX + x - 10) + 'px';  /* slightly closer to finger */
  img.style.top  = (window.scrollY + y - 10) + 'px';
  img.style.width = '25px';
  img.style.height = '25px';
  img.style.pointerEvents = 'none';
  img.style.zIndex = 9999;
  img.style.transition = 'transform 1s ease-out, opacity 1s ease-out';
  img.style.opacity = '1';
  document.body.appendChild(img);
  requestAnimationFrame(()=>{  /* animate next frame */
    img.style.opacity='0';
    img.style.transform='scale(0.6) rotate(20deg)';
  });
  setTimeout(()=> img.remove(), 1000);
}
document.addEventListener('mousemove', e => dropBow(e.clientX, e.clientY));
document.addEventListener('touchmove', e => {
  const t = e.touches[0]; if(!t) return;
  dropBow(t.clientX, t.clientY);
}, { passive: true });

/* -------------------- Timeline LEDs (pulse) -------------------- */
function positionLEDsInsidePoints() {
  document.querySelectorAll('.point .timeline-led').forEach(l => l.remove());
  document.querySelectorAll('.point').forEach(point => {
    const led = document.createElement('div');
    led.className = 'timeline-led';
    point.appendChild(led);
  });
}
positionLEDsInsidePoints();
window.addEventListener('resize', positionLEDsInsidePoints);
let pulseTime = 0;
function pulseTimelineLEDsSmooth(){
  const leds = document.querySelectorAll('.timeline-led');
  pulseTime += 0.02;
  leds.forEach((led, i)=>{
    const phase = (i / (leds.length||1)) * Math.PI * 2;
    const scale = 1 + 0.3 * Math.sin(pulseTime + phase);
    const opacity = 0.3 + 0.7 * Math.sin(pulseTime + phase) ** 2;
    led.style.transform = `translate(-50%, -50%) scale(${scale})`;
    led.style.opacity = opacity;
    const glow = 6 + 6 * Math.sin(pulseTime + phase);
    led.style.boxShadow = `0 0 ${14+glow}px ${glow}px rgba(255,255,255,0.5)`;
  });
  requestAnimationFrame(pulseTimelineLEDsSmooth);
}
requestAnimationFrame(pulseTimelineLEDsSmooth);

/* -------------------- Canvas 'PCB' -------------------- */
const canvas = document.getElementById('journey-bg');
const ctx = canvas?.getContext ? canvas.getContext('2d') : null;
let particles = [];
function resizeCanvas(){
  if(!canvas) return;
  const main = document.getElementById('main-content');
  canvas.width = main.offsetWidth;
  canvas.height = main.offsetHeight;
  generateParticles();
  drawPCB();
}
window.addEventListener('resize', resizeCanvas);
function generateParticles(){
  particles = [];
  for(let i=0;i<50;i++){
    particles.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, length: 20+Math.random()*50, vertical: Math.random()<0.5, speed:1+Math.random()*1.5});
  }
}
function drawPCB(){
  if(!ctx) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(const p of particles){
    ctx.strokeStyle = 'rgba(255,255,255,' + (0.9 + Math.random()*0.12) + ')';
    ctx.lineWidth = 1 + Math.random()*1;
    ctx.beginPath();
    if(p.vertical) { ctx.moveTo(p.x,p.y); ctx.lineTo(p.x,p.y+p.length); }
    else { ctx.moveTo(p.x,p.y); ctx.lineTo(p.x+p.length,p.y); }
    ctx.stroke();
  }
}
function animatePCB(){
  drawPCB();
  for(const p of particles){
    if(p.vertical){ p.y += p.speed; if(p.y > canvas.height) p.y = -p.length; }
    else { p.x += p.speed; if(p.x > canvas.width) p.x = -p.length; }
  }
  requestAnimationFrame(animatePCB);
}
animatePCB();

/* -------------------- Sidebar behavior -------------------- */
const sidebar = document.getElementById("achievement-sidebar");
const toggle = document.getElementById("sidebar-toggle");

// Desktop: hover expands via CSS (no JS needed)
// Mobile: tap-to-open/close using class toggle
function isMobile(){ return window.matchMedia("(max-width: 600px)").matches; }

function handleSidebarTap(){
  if(!isMobile()) return;
  // toggle class; also stop clicks from leaking
  sidebar.classList.toggle("mobile-open");
}

if(toggle){
  toggle.addEventListener("click", (e)=>{ e.stopPropagation(); handleSidebarTap(); });
}
// Also let tapping the bar itself open on mobile
sidebar.addEventListener("click", (e)=>{
  if(!isMobile()) return; // desktop uses hover
  // ignore clicks on links inside when already open
  if(sidebar.classList.contains("mobile-open") && e.target !== toggle) return;
  handleSidebarTap();
});

/* -------------------- Init -------------------- */
async function init(){
  await renderMessages();
  await renderGallery();
  resizeCanvas();
}
window.addEventListener('load', init);

/* -------------------- Launch Screen -------------------- */
const launchScreen = document.getElementById('launch-screen');
launchScreen.addEventListener('click', () => {
  launchScreen.style.animation = 'fadeOut 1s forwards';
  setTimeout(() => {
    launchScreen.remove();
    unlockAchievement('Hello, World!');
  }, 500);
});
</script>

<!-- Achievement Sidebar (after script so DOM exists for IDs) -->
<div id="achievement-sidebar">
  <div id="sidebar-toggle" aria-label="Open achievements"></div>
  <div id="achievements-unlocked">
    <h3>Achievements</h3>
    <div id="achievements-list"></div>
  </div>
</div>
</body>
</html>


